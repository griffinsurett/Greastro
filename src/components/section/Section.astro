---
// src/components/section/Section.astro
import { getCollection } from 'astro:content';
import type { CollectionKey } from 'astro:content';
import { getVariantComponents } from '@/components/section/variants/utils/VariantUtils';
import { prepareCollectionData, prepareStaticData } from '@/components/section/variants/utils/DataPreparer';

const variantComponents = await getVariantComponents();

// Astro needs Props defined IN the component for type checking
interface Props {
  collection?: CollectionKey;
  variant?: string;
  [key: string]: any;
}

const {
  collection,
  variant = 'GridVariant',
  ...restProps
} = Astro.props;

let data: any;

if (collection) {
  const entries = await getCollection(collection);
  const items = await prepareCollectionData(entries, collection);
  data = { items, ...restProps };
} else {
  data = prepareStaticData(Astro.props);
}

const VariantComponent = variantComponents[variant];
---

<VariantComponent {...data} />