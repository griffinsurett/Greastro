---
// src/pages/[collection]/index.astro
import type { CollectionKey } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Section from "@/components/section/Section.astro";
import { collections } from "@/content/config";
import { getCollectionMeta } from "@/utils/fetchMeta";

export async function getStaticPaths() {
  const names = Object.keys(collections) as CollectionKey[];
  const paths = [];

  for (const coll of names) {
    const meta = getCollectionMeta(coll);
    if (meta.hasPage) {
      paths.push({ params: { collection: coll } });
    }
  }

  return paths;
}

const { collection } = Astro.params;
const meta = getCollectionMeta(collection);

let Content = null;
let hasRealContent = false;

try {
  const mod = await import(`../../content/${collection}/_meta.mdx`);
  Content = mod.default;
  
  // MDX files with actual content will have more exports than just default and frontmatter
  // Empty MDX files typically only have these two
  const exportKeys = Object.keys(mod);
  hasRealContent = exportKeys.length > 2 || 
                   (exportKeys.length === 2 && !exportKeys.includes('frontmatter'));
} catch {
  // No MDX file exists
}
---

<Layout title={meta.title || collection}>
  {Content && hasRealContent ? (
    <Content />
  ) : (
    <Section 
      collection={collection} 
      variant="GridVariant"
      title={meta.title || collection}
      description={meta.description}
    />
  )}
</Layout>